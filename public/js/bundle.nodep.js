var util={trimRegex:/^\s+|\s+$/g,hasClass:function(e,t){return-1<e.className.indexOf(t)},addClass:function(e,t){e.className+=" "+t},removeClass:function(e,t){e.className=e.className.replace(t,"").replace(util.trimRegex,"")},bindEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n)},getEventTarget:function(e){var t=e.currentTarget?e.currentTarget:e.srcElement;if(t)return"span"===t.nodeName.toLowerCase()&&(t=t.parentNode),t},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},parseXML:function(e){var t,n;return(t=document.createElement("div")).innerHTML="<xml>"+e+"</xml>",document.body.appendChild(t),n=t.firstChild.XMLDocument,document.body.removeChild(t),n.documentElement},xmlToObj:function(e){for(var t,n,a={},i=e.childNodes,l=0;l<i.length;l++)n=(t=i[l]).nodeName.length+2,a[t.nodeName]=t.xml.substring(n,t.xml.length-n-1);return a},requestPage:function(e,t){var n=new XMLHttpRequest,a="undefined"!=typeof JSON;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&this.responseText&&t(null,a?JSON.parse(this.responseText):util.xmlToObj(util.parseXML(this.responseText)))},n.open("GET","/"+e+"?"+(a?"json":"xml&"+(new Date).getTime())),n.send()}},page={getPageLinks:function(){return document.getElementById("pageLinks").getElementsByTagName("a")},getTabs:function(){return document.getElementById("tabs").getElementsByTagName("li")},getContentDivs:function(){return document.getElementById("content").children}},bsy={selectTab:function(e){var t,n,a=e,i=util.getEventTarget(e),l=page.getTabs(),s=page.getContentDivs();i&&(a=i.getAttribute("data-tab"));for(var r=0;r<l.length;r++)t=l[r],n=s[r],t&&(util.removeClass(t,"active"),t.getAttribute("data-tab")===a&&util.addClass(t,"active")),n&&(util.removeClass(n,"active"),n.id==="tab-"+a&&util.addClass(n,"active"))},closeTab:function(e){util.preventDefault(e);var t=util.getEventTarget(e).getAttribute("href");-1<t.indexOf("http")&&(t=t.split("/").pop());t=t.substring(1);var n=document.getElementById("tab-"+t);n.parentNode.removeChild(n);for(var a=page.getTabs(),i=0;i<a.length;i++)a[i].getAttribute("data-tab")===t&&a[i].parentNode.removeChild(a[i]);for(var l=page.getPageLinks(),s=0;s<l.length;s++)-1<l[s].getAttribute("href").indexOf("/"+t)&&util.removeClass(l[s],"open")},addTab:function(e){var t=document.createElement("li");t.className="file-link",t.setAttribute("data-tab",e.slug),util.bindEvent(t,"click",bsy.selectTab);var n=document.createElement("i");n.className="fas fa-file icon-file",t.appendChild(n);var a=document.createElement("span");a.appendChild(document.createTextNode(e.slug)),t.appendChild(a);var i=document.createElement("a");i.setAttribute("href","#"+e.slug),i.className="close-tab",i.appendChild(document.createTextNode("X")),util.bindEvent(i,"click",bsy.closeTab),t.appendChild(i),document.getElementById("tabs").appendChild(t);var l=document.createElement("div");l.id="tab-"+e.slug,l.innerHTML=e.content||e.compiled,document.getElementById("content").appendChild(l),bsy.selectTab(e.slug)},openPage:function(e){util.preventDefault(e);var n=util.getEventTarget(e);if(id=n.getAttribute("href"),-1<id.indexOf("http")){var t=id.split("/");id=t.pop()}else id=id.substring(1);util.hasClass(n,"open")?bsy.selectTab(id):util.requestPage(id,function(e,t){bsy.addTab(t),util.addClass(n,"open")})},init:function(){for(var e=page.getTabs();0<e.length;e++){util.bindEvent(e[0],"click",bsy.selectTab);for(var t=e[0].children,n=0;n<t.length;n++)util.hasClass(t[n],"close-tab")&&(util.bindEvent(t[n],"click",bsy.closeTab),t[n].style.display="")}for(var a=page.getPageLinks(),i=0;i<a.length;i++)util.bindEvent(a[i],"click",bsy.openPage)}};window.onload=bsy.init;